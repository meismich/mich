# FILE:		apeagers.conf
# AUTHOR:	Michael Spence
# DATE:		2012-07-20
#
# PURPOSE::
# 	AP Eagers Firewall Config
#

##### ##### MACROS ##### #####
# Interfaces
ext_if =		"em0"   # External Interface
int_if =		"em1"   # Internal Interface

##### PORTS
# Proxy internet ports
pts_inet =		"80 443 3128"

# Citrix Ports
citrix_ports =		"80 443 1494 2598 2512 2513 8080"
ports_ctx1 =		"443"
ports_ctx2 =		"80 443"
ports_ctx3 =		"80 443 1494"

volvo_ports =		"5031 449 8470:8476"


# Connection Ports
port_bma_cctv1 = 	"50000"
port_bma_ccweb = 	"50001"

#MSN Messenger Ports
pts_msn =		"1493 1542 1863 1963"

# File Sharing PTP
pts_tor =		"6881 37001 37002 37003 37000"
pts_p2p =		"1214 5000 5555 6346 777 8331 8875 8888 6257 6699"
pt_cvsup =		"5999"
pt_pptp =		"1723"

# Instant Messaging Clients
pt_jabber =		"5222"
pt_icqaim =		"5190"
pt_irc =		"6667"

# Macromedia Flash RTMP
pt_rtmp =		"1935 554"
pt_apple =		"5223"

# BAD PORTS
pts_bad =		$pts_msn $pts_tor $pts_p2p $pt_cvsup $pt_pptp $pt_jabber $pt_icqaim $pt_irc $pt_rtmp $pt_apple

##### A.P. EAGERS DATA CENTRE
# External Addresses
ext_owa_qld =		"203.38.61.193"		# OWA Ext (aka owa.apeagers.com.au)
ext_194 =		"203.38.61.194"		# TEMP ERANET RDP  == TUNE !!!
ext_195 =		"203.38.61.195"		# TEMP ERANET RDP
ext_196 =		"203.38.61.196"		# TABLET CITRIX
ext_197 =		"203.38.61.197"		# REMOTE CITRIX
ext_198 =		"203.38.61.198"		# TEMP CITRIX
ext_ftp_zoos =		"203.38.61.199"		# Carzoos FTP
ext_ftp_qld1 =		"203.38.61.203"		# AP Eagers FTP
ext_ftp_qld2 = 		"203.38.61.204"		# Carzoos FTP
ext_citrix =		"203.38.61.205"		# NFuse Ext (aka citrix.apeagers.com.au)
ext_intranet =		"203.38.61.206"		# Intranet Ext

# Internal Addresses
int_aus_intranet =	"10.1.1.50"
int_bne_apps =		"10.1.1.93"
int_bne_btac =		"10.1.1.8"
int_bne_caplink =	"10.1.1.41"
int_bne_dax09 =		"10.1.1.22"
int_bne_dc2 =		"10.1.1.42"
int_bne_eranet = 	"10.1.1.25 10.1.11.9 10.1.1.9" 
int_bne_iis =		"10.1.1.90"
int_bne_isa =		"10.1.1.18"
int_bne_mx1 =		"10.1.0.32"
int_citrixgabba =	"10.1.1.6"
int_corp_board =	"10.16.100.90"
int_dwn_eranet =	"10.1.1.48"
int_intranet =		"10.1.1.13"
int_inf_media =		"10.11.254.100"		# Infinity Media Stream (BOSE) -- MS 2013-01-17
int_mgmt_if =		"192.168.248.0/24"
int_qld_cit1 =		"10.1.1.65"
int_qld_csp =		"10.1.1.80"
int_qld_isa =		"10.1.1.59"
int_qld_tftp =		"10.1.1.24"
int_dcs_net =		"10.40.1.36"
int_vga_juniper = 	"10.1.1.240"		# Internal Facing interface of Juniper
int_ssh_mbox =		"10.2.7.239"
int_ewn_ava =		"10.12.254.199"
int_vexecera =		"10.1.1.11"
int_bma_cctv =		"10.32.3.150"
int_nos_box =		"10.1.1.7"
int_temsvr =		"10.1.254.5"

int_tune_qld =		"10.36.1.2"
int_tune_nla = 		"10.25.4.2"
int_tune_ttb =		"10.36.4.2"

int_qld_titan =		"10.1.100.21"

int_gk =		"10.1.1.18"

b2b_rnr_fis = 		"10.40.1.51"
b2b_vga_juniper =	"10.40.1.61"		# External Facing interface of Juniper

#dms_era1 =		"172.20.3.40"
#dms_era2 =		"172.20.3.41"

##### PROXY BYPASS SITES
# Manufacturer Sites
sites_apeagers =	"210.247.230.30, 117.55.229.217, 113.192.56.109, 113.192.56.110, 203.94.176.170"
sites_audi =		"10.112.192.0/24, 10.112.230.0/24, 10.166.145.0/24, 61.88.114.35, 150.101.216.29, 59.167.181.51"
sites_autoreg = 	"125.7.40.108"
sites_autogrid =	"19.197.2.93, 19.197.2.171, 19.197.2.183, 19.197.6.35, 136.8.159.0/24, 136.9.242.0/24, 136.9.246.0/24, 136.9.249.0/24, 136.9.252.0/24, 136.130.208.0/24, 192.28.103.0/24, 193.129.10.228, 19.110.66.48"
sites_bbu =		"223.130.24.13"
sites_bidsonline =	"210.8.199.67, 210.8.199.73, 210.8.223.54, 210.8.223.59, 210.9.75.162, 210.8.199.78"
sites_capital_finance =	"202.160.110.10, 203.161.186.14"
sites_citroen =		"74.125.19.147, 81.255.178.161, 194.250.98.0/24, 203.210.109.237"
								# Citroen France (Manpreet 2012-06-22... MS)
sites_contact_tracker = ""
sites_dealerlink =	"10.20.0.0/16, 10.21.0.0/16, 10.30.0.0/16, 10.31.0.0/16, 10.40.3.0/24, 10.40.5.0/24, 10.40.6.0/24, 10.40.7.0/24, 10.40.9.0/24, 10.41.0.0/16, 10.81.7.0/24, 10.81.12.0/24, 10.81.34.0/24, 10.81.51.0/24, 10.81.60.0/24, 10.81.80.0/24, 10.81.105.0/24, 10.81.114.0/24, 10.81.122.0/24, 10.81.127.0/24, 10.81.142.0/24, 10.81.168.0/24, 10.81.174.0/24, 10.81.205.0/24, 10.81.241.0/24, 10.82.6.0/24, 10.85.41.0/24, 10.100.12.0/24, 100.100.150.0/24, 122.122.125.5, 122.122.125.30, 172.20.3.66, 172.20.3.98, 172.20.3.132, 172.20.3.162, 172.20.3.194, 172.20.4.34, 192.168.0.5, 192.168.3.0/24, 192.168.24.0/24, 192.168.30.0/24, 203.13.244.0/24, 203.23.31.0/24, 203.25.41.0/24, 203.25.42.0/24, 203.53.30.232, 203.166.118.195"
sites_ford =		"64.14.29.50, 136.1.25.105, 136.2.12.190, 136.1.241.107, 136.1.29.151, 136.1.29.152, 119.225.110.0/24, 74.125.237.104, 136.1.241.57, 64.14.29.50, 64.14.29.250, 64.14.29.251, 64.14.29.252, 136.1.25.105, 136.1.60.20"
sites_holden =		"66.235.128.158, 66.235.132.121, 66.235.132.152, 72.247.49.230, 72.5.123.29, 72.247.247.88, 96.6.229.230, 148.95.0.0/16, 198.208.16.25, 198.208.16.26, 198.208.54.157, 198.208.154.157, 198.208.187.168, 210.15.228.172, 210.15.228.178"
sites_holden_dcs = 	"198.208.100.40, 198.208.100.56, 198.208.100.57, 198.208.100.41, 198.208.99.40, 198.208.100.42, 198.208.99.56, 198.208.99.57, 198.208.99.41"
sites_honda = 		"144.135.6.130 203.48.59.28, 202.125.164.102, 180.148.71.10, 180.148.71.74"		# VPN address 180.x will replace 203.x (Honda 2012-07-04... MS)
sites_inchape =		"192.168.3.3 59.154.25.5"
sites_infiniti = 	"203.41.2.0/24"
sites_jaguar =		"72.247.247.161, 72.247.247.176, 80.231.29.29, 96.6.230.123, 140.174.24.168, 140.174.24.201, 113.52.6.70"
sites_kia =		"203.53.30.232, 203.36.185.242"
sites_mazda =		"10.3.0.0/16, 10.4.0.0/16, 19.190.18.0/24, 19.197.2.141"
sites_mitsubishi =	"159.196.36.12, 159.196.36.15, 159.196.36.16, 159.196.36.125, 202.45.13.114, 159.196.36.10, 62.154.166.151, 193.159.191.18, 199.7.71.190,  23.62.245.68, 199.7.51.190"
sites_peugeot =		"203.53.30.233, 81.255.178.0/24, 91.213.242.0/24, 66.102.11.104"
sites_porsche =		"10.61.1.0/24, 10.61.248.65, 10.61.248.66, 84.21.39.0/24, 84.21.52.11, 84.21.53.11, 84.21.53.14, 84.21.53.16, 141.36.132.85, 192.168.200.34, 193.175.6.2, 193.175.6.66, 203.26.190.6, 203.26.190.226, 210.193.227.1"
sites_subaru =		"59.154.25.14 59.154.25.3 64.211.65.68"		# Inchape (Michael 2012-06-19... MS)
									# FTP Access (Luke@Pentana 2012-06-28... MS)
sites_titan =		"111.125.161.43"				# TEMPORARY TITAN (Colin 2013-02-06... MS)
sites_toyota =		"10.9.100.0/24, 132.147.0.0/16, 150.45.0.0/16, 192.168.42.0/24, 192.168.101.0/24, 192.168.108.0/24, 192.168.109.0/24, 192.168.206.0/24, 208.39.44.0/24, 208.39.45.0/24, 216.14.206.48, 210.193.207.91, 203.41.139.123, 203.36.194.133, 203.110.128.74, 210.193.163.23"		# (last 2) Toyota Finance (Helpdesk 2012-06-18... MS)
sites_volvo =		"212.181.101.128/25, 212.181.101.0/24, 212.181.102.0/24, 212.181.103.0/24, 136.8.154.0/24"
sites_vw =		"10.112.198.0/24, 10.152.15.0/24, 172.16.61.0/24, 210.193.223.156, 194.114.32.0/24"


# Associated Sites
sites_addresslink =	"203.25.40.67"
sites_ateco =		"219.148.138.164, 219.148.138.165"	# Ateco (Manpreet 2012-06-20... MS)
sites_ato =		"203.202.41.80, 203.202.41.78, 180.149.195.57, 180.149.195.113"
sites_autopartners_old  = 	"168.87.78.56, 168.87.78.57, 125.56.181.230"
sites_autoquote = 	"174.142.126.100 59.167.218.109 59.167.218.126"	# Estimage (Manpreet 2012-06-18... MS), VNC connect (Manpreet 2012-07-03... MS)
sites_caplink =		"203.153.237.100"
sites_carsales =	"140.174.24.8, 140.174.24.80, 140.174.24.177, 140.174.24.218"
sites_dais =		"203.94.167.209, 203.9.185.207, 203.9.185.233"
sites_dealerlogic =	"203.94.176.180, 203.94.176.181, 203.94.176.188, 202.58.227.102, 203.94.176.177, 202.58.227.46"
sites_directfreight =	"125.254.30.17"
sites_fowles =		"203.166.110.40, 203.166.110.41"
sites_gen_e =		"59.167.181.41, 59.167.181.51, 46.137.83.7, 82.112.109.1, 61.9.209.145, 61.9.209.153, 199.7.54.190, 82.112.109.7, 82.112.109.9, 81.112.108.41, 222.73.216.70, 125.56.205.104, 118.214.195.235, 125.56.205.72, 125.56.179.235, 82.112.108.41"
sites_get_genuine =	"49.50.243.30"
sites_ibmhmc =		"129.42.160.48, 129.42.160.50, 207.25.252.200, 207.25.252.205"
sites_liberty =		"202.45.13.114, 202.45.13.124"
sites_manheim =		"125.255.134.69 125.255.134.71"		# Manheim Fowles Simulcast (Bradley 2012-06-28... MS)
sites_motorone =	"203.35.213.102, 203.38.68.178"
sites_partscheck =	"122.201.111.1 122.201.103.44"
sites_pickles =		"202.58.54.235 111.125.168.18 111.125.172.98 111.125.172.88 111.125.172.103 111.125.172.81"
sites_ppsr =		"115.178.111.69"
sites_redhat =		"209.132.183.44, 173.222.192.218"
sites_smslink = 	"203.25.40.47"
sites_stgeorge =	"166.120.202.249, 203.16.39.0/24, 203.16.39.136, 203.16.39.137, 203.16.39.138, 203.16.39.139, 203.23.44.136, 203.23.44.137, 203.23.44.138, 203.23.44.139, 203.16.39.23"
sites_strategi =	"203.39.222.97"				# Citroen (Manpreet 2012-06-18... MS)
sites_suncorp =		"203.0.222.230, 203.0.222.16, 203.0.222.101, 203.110.139.190, 203.0.222.0/24"
sites_tipt =		"203.44.43.220"
sites_vital =		"202.125.164.104, 67.19.91.90, 202.125.173.52"
sites_fuel = 		"203.47.73.147"
sites_ntp =		"129.127.40.3"
sites_kumho =		"59.154.25.75"
sites_fairtrade =	"131.242.135.160" 
sites_totalcheck =	"203.36.59.80"			# New Pentana Product "totalcheck.sensis.com.au" (Mark Glenn 2013-02-11... MS)

# Microsoft 365 (Lists from http://onlinehelp.microsoft.com/en-au/office365-enterprises/hh373144.aspx)
sites_365_nets = "65.54.74.0/23, 65.54.80.0/20, 65.55.86.0/23, 70.37.128.0/23, 70.37.142.0/23, 70.37.159.0/24, 94.245.68.0/22, 94.245.82.0/23, 94.245.84.0/24, 94.245.86.0/24, 111.221.23.128/25, 111.221.66.0/25, 111.221.69.128/25, 111.221.70.0/25, 111.221.71.0/25, 111.221.112.0/21, 111.221.116.0/24, 111.221.127.112/28, 132.245.0.0/16, 157.55.130.0/25, 157.55.145.0/25, 157.55.155.0/25, 157.55.227.192/26, 157.55.59.128/25, 157.56.53.128/25, 157.56.55.0/25, 157.56.58.0/25, 157.56.151.0/25, 157.56.200.0/23, 207.46.57.128/25, 207.46.70.0/24, 207.46.150.128/25, 207.46.198.0/25, 207.46.206.0/23, 207.46.58.128/25, 213.199.148.0/23, 213.199.182.128/25"
sites_365_ips = "65.52.196.64, 65.52.208.73, 65.52.240.233, 65.54.55.201, 65.54.165.55, 65.55.150.158, 65.55.150.160, 65.55.150.61, 65.55.239.168, 70.37.97.234, 94.245.108.85, 94.245.117.53, 111.221.111.196, 157.55.185.100, 157.55.194.46, 207.46.14.52, 207.46.14.62, 207.46.14.63, 207.46.216.54, 207.46.73.250"
sites_microsoft =	"111.221.0.0/16  94.245.0.0/16  64.18.0.0/16  65.55.0.0/16  65.54.0.0/16  213.199.0.0/16  207.46.0.0/16  118.215.0.0/16  210.247.0.0/16  144.135.0.0/16  70.37.0.0/16  65.52.0.0/16  157.56.58.0/25  157.55.155.0/25  157.55.130.0/25  157.55.145.0/25  157.55.227.192/26  157.55.59.128/25  157.56.55.0/25  132.245.0.0/16, 199.7.55.190, 199.7.51.72, 199.7.48.190, 199.7.59.72, 199.7.54.72, 184.31.201.139, 64.4.11.25, 61.9.209.146, 61.9.209.162, 64.4.30.171, 23.63.9.139, 125.56.176.47, 184.86.223.32, 23.63.0.47, 184.86.223.65"		# From Tests these appeared to be what was required (Michael 2013-03-05... MS)
sites_ms_act =		"157.55.44.71"
sites_ms_test =		"169.254.199.52"

# Testing
sites_test =		"61.9.209.162"

inet_butterfly = 	"210.15.233.194"
inet_gen_e =		"59.167.181.41"
inet_tmca =		"203.53.49.244 203.53.49.245"
inet_revolution =	"203.36.194.133"

##### A.P. EAGERS SITES
ape_billbuckles =	"203.43.230.186"
ape_klosters =		"203.38.221.86"
ape_surfers =		"210.56.85.111, 210.56.85.112"
ape_darwin =		"203.43.230.178"
ape_newstead =		"139.130.41.14"
ape_queensland =	"165.228.157.90"
ape_adtrans =		"210.8.187.102"

###################################################################################################################
##### ##### TABLES ##### #####
# INTERNAL SOURCES
# Hosts allowed Un-filtered Internet Access
int_raw = 		10.32.77.77 10.32.100.77 10.1.0.10 10.1.100.20 10.32.100.254 10.1.1.92
table <int_raw> const { $int_raw }

table <int_tune> const { $int_tune_qld $int_tune_nla $int_tune_ttb }

# Hosts allowed HTTP, HTTPS or SQUID internet access
int_proxy =		$int_bne_btac $int_bne_caplink $int_bne_dc2 $int_bne_eranet $int_dcs_net $int_dwn_eranet $int_ssh_mbox \
			$int_ewn_ava $int_bne_isa $int_qld_isa $int_qld_csp $int_temsvr 10.10.16.201 10.32.254.10 10.1.1.32 \
			10.1.1.31 10.35.18.100 10.1.1.49 10.1.1.43 $int_inf_media $int_corp_board
table <int_proxy> const { $int_proxy }

b2b_proxy =		$b2b_rnr_fis $b2b_vga_juniper
table <b2b_proxy> const { $b2b_proxy }

# Hosts allowed SMTP internet access
int_mail =		10.1.0.10 10.1.1.10 10.1.1.32 10.1.1.33 10.1.1.50
table <int_mail> const { $int_mail }

table <internal_sources> const { $int_raw $int_proxy $b2b_proxy $int_mail }

# INTERNET DESTINATIONS
# Non Proxied, Destination Hosts
table <inet_good> const { $sites_apeagers $sites_audi $sites_autoquote $sites_autoreg $sites_autogrid $sites_bbu $sites_bidsonline $sites_capital_finance\
			$sites_citroen $sites_contact_tracker $sites_dealerlink $sites_ford $sites_holden $sites_holden_dcs $sites_honda \
			$sites_inchape $sites_infiniti $sites_jaguar $sites_kia $sites_mazda $sites_mitsubishi $sites_peugeot \
			$sites_porsche $sites_subaru $sites_titan $sites_toyota $sites_volvo $sites_vw $sites_addresslink $sites_ateco $sites_ato \
			$sites_autopartners_old $sites_caplink $sites_carsales $sites_dais $sites_dealerlogic \
			$sites_directfreight $sites_fowles $sites_gen_e $sites_get_genuine $sites_ibmhmc $sites_liberty $sites_manheim $sites_microsoft \
			$sites_motorone $sites_partscheck $sites_pickles $sites_ppsr $sites_redhat $sites_smslink $sites_stgeorge $sites_strategi \
			$sites_suncorp $sites_tipt $sites_vital $sites_fuel $sites_ntp $sites_kumho $sites_fairtrade $sites_totalcheck \
			$sites_365_nets $sites_365_ips $sites_ms_act $sites_ms_test }

table <inet_bad> const { 83.140.247.20 32.60.9.237 32.60.13.237 123.2.106.220 203.175.187.177 64.4.23.156 178.248.142.82 \
			95.29.220.54 94.50.144.89 61.216.248.124 122.149.42.218 61.216.248.124 142.167.71.27 \
			211.31.205.117 17/8 }


##### EXTERNAL HOSTS
table <ext_ctxs> const { $ext_196, $ext_197 }

##### EXTRANET NETWORKS
table <xnet_audi> const { 10.112.192.0/24, 10.166.145.0/24 }
table <xnet_vw> const { 10.112.198.0/24, 10.112.230.0/24, 10.152.15.0/24, 172.16.61.0/24, 210.193.223.156 }
table <xnet_toyota> const { 10.9.100.0/24, 132.147.0.0/16, 150.45.0.0/16, 192.168.42.0/24, 192.168.101.0/24, 192.168.108.0/24, 192.168.109.0/24, 192.168.206.0/24 }

table <xnet_volvo> const { 212.181.101.128/25,  212.181.102.0/24, 212.181.103.0/24 }

##### INTERNET HOSTS
table <inet_vwaudi> const { 59.154.32.6, 61.88.114.38, 119.225.2.78, 210.48.210.1 }
table <inet_tune> const { $inet_tmca $inet_revolution 139.130.41.14 }

table <inet_vital> const { 203.206.162.162 202.125.173.39 1/8 139.130.41.14 }
table <inet_titan> const { 203.206.169.89 203.217.12.189 203.59.99.218 203.59.134.193 }

##### A.P. EAGERS SITES
table <ape_sites> const { $ape_billbuckles, $ape_klosters, $ape_surfers, $ape_darwin, $ape_newstead, $ape_queensland, $ape_adtrans }

table <remote_svrs> const { $int_tune_qld, $int_tune_nla, $int_tune_ttb, $int_bma_cctv, $int_gk }

###################################################################################################################
##### ##### ##### OPTIONS ##### ##### #####
# Skip Rules for loopback interface
set skip on lo
set block-policy drop
set loginterface em0
set limit states 40000
set optimization conservative

###################################################################################################################
##### ##### ##### NORMALISATION ##### ##### #####
# Scrub
scrub in all

###################################################################################################################
##### ##### ##### TRANSLATION ##### ##### #####
# Default NAT/RDR
nat on $ext_if from <internal_sources> -> ($ext_if:0)
#nat on $ext_if proto { tcp, udp } from <internal_sources> to any port { 80, 443, 3128 } -> ($ext_if:0)
nat on $ext_if from any to <inet_good> -> ($ext_if:0)
nat on $ext_if proto { tcp, udp } from any to any port domain -> ($ext_if:0)
nat on $ext_if proto icmp from !($ext_if) -> ($ext_if:0)

##### EXTRANET NATS
nat on $int_if from any to <xnet_audi> -> $int_if
nat on $int_if from any to <xnet_vw> -> $int_if
nat on $int_if from any to <xnet_toyota> -> $int_if

nat on $ext_if proto tcp from any to <ape_sites> port 3389 -> ($ext_if:0)

# NAT for DWN ERA *** pah046.ford.com (via Autogrid) ***
# nat on $b2b_if from $dms_era1 to 19.190.18.11 -> $b2b_if

# NAT for remote servers (ie not at data centre)
nat on $int_if from any to <remote_svrs> -> $int_if

# FTP Anchor
nat-anchor "ftp-proxy/*"
rdr-anchor "ftp-proxy/*"
rdr on $int_if proto tcp from any to any port ftp -> 127.0.0.1 port 8021

rdr on $int_if proto tcp from any to 17.171.4.35 port 123 -> 10.1.1.43 port 123

##### REMOTE SERVER ACCESS
# Terminal Services Gateway
rdr on $ext_if proto tcp from any to (em0:0) port https -> $int_gk port https

# Redirect from APEagers Sites to FTP servers and Intranet
#rdr on $ext_if proto tcp from <inet_vital> to $ext_ftp_zoos port ftp -> $int_qld_tftp port 8021
rdr on $ext_if proto tcp from <inet_vital> to $ext_ftp_zoos port { ftp-data 2024:65535 } -> $int_qld_tftp

rdr on $ext_if proto tcp from <inet_vital> to $ext_ftp_zoos port 1122 -> $int_qld_tftp port 22
rdr on $ext_if proto tcp from <ape_sites> to $ext_ftp_qld1 port { ftp 49151:65535 } -> $int_bne_iis
rdr on $ext_if proto tcp from <ape_sites> to $ext_ftp_qld2 port { ftp 49152:65535 } -> $int_bne_dax09
rdr on $ext_if proto tcp from <ape_sites> to $ext_intranet port www -> $int_aus_intranet

rdr on $ext_if proto tcp from any to any port $port_bma_cctv1 -> $int_bma_cctv port 6100
rdr on $ext_if proto tcp from any to any port $port_bma_ccweb -> $int_bma_cctv port 80

# Redirect to Citrix and OWA
rdr on $ext_if proto tcp from any to <ext_ctxs> port { $citrix_ports } -> $int_qld_cit1
rdr on $ext_if proto tcp from any to $ext_citrix port { $citrix_ports } -> $int_citrixgabba

# Redirect Butterfly to Intranet
rdr on $ext_if proto tcp from $inet_butterfly to any port { ssh http https } -> $int_aus_intranet

# TITAN RDP
rdr on $ext_if proto tcp from <inet_titan> to $ext_194 port 3389 -> $int_qld_titan port 3389

# TEMPORARY ERANET RDP
#rdr on $ext_if proto tcp from any to $ext_195 port 3389 -> 10.1.1.9

# Redirect VW VGA Juniper
rdr on $ext_if from <inet_vwaudi> to any -> $b2b_vga_juniper # VW/Audi VPN to Ext int of VGA Juniper

# Redirect Executive Anywhere web traffic
#rdr on $b2b_if proto { tcp, udp } from any to any port 17280 -> $int_vexecera port 80

# Redirect Darwin ERA Telnet traffic
rdr on $int_if proto { tcp, udp } from any to any port 17240 -> 172.20.3.40 port 23

# Redirects for Tune access to Servers
#rdr on $ext_if proto tcp from <inet_tune> to $ext_194 port 33890 -> $int_tune_qld port 3389
#rdr on $ext_if proto tcp from <inet_tune> to $ext_194 port 33891 -> $int_tune_nla port 3389
#rdr on $ext_if proto tcp from <inet_tune> to $ext_194 port 33892 -> $int_tune_ttb port 3389

# Redirects for Apps TS Server
rdr on $ext_if proto tcp from any to $ext_197 port 33890 -> $int_bne_apps port 3389

rdr on $ext_if proto tcp from <inet_tune> to $ext_194 port { ftp-data ftp 49152:65535 } -> 10.1.4.11

###################################################################################################################
##### ##### ##### FILTERING ##### ##### #####
# FTP Anchor
anchor "ftp-proxy/*"

# Default deny
block in log all
pass out log quick on $ext_if from ($ext_if:0) to any
block out log quick on $ext_if

# Raw Internet
pass in log quick on $int_if proto { tcp, udp } from <int_raw> to any 
pass in log quick on $ext_if proto { tcp, udp } from any to <int_raw>

# Block Bad Internet
block in log quick on $ext_if from <inet_bad> to any
block in log quick on $ext_if from any to <inet_bad>

# Mail Traffic
#pass in log quick on $int_if proto { tcp, udp } from <int_mail> to any port 25
pass in log quick on $int_if proto { tcp, udp } from <int_mail> to any

# Proxy Servers Can access Internet
pass in quick on $int_if proto { tcp, udp } from <int_proxy> to any port { $pts_inet }
pass in quick on $int_if proto { tcp, udp } from <b2b_proxy> to any port { $pts_inet }

# Good Destinations can be reached
pass in quick on $int_if proto { tcp, udp } from any to <inet_good>

# Pass VGA Internet traffic to Juniper
pass in log quick on $ext_if from <inet_vwaudi> to $b2b_vga_juniper keep state

# Pass Volvo Internet traffic
pass in log quick on $int_if proto { tcp, udp } from any to <xnet_volvo> port { $volvo_ports }

##### REMOTE SERVER ACCESS
# Terminal Services Gateway
pass in log quick on $ext_if proto tcp from any to $int_gk port https keep state

# Allow access from APEagers Sites to FTP servers and Intranet
pass in log quick on $ext_if proto tcp from <inet_vital> to $ext_ftp_zoos port 21
pass in log quick on $ext_if proto tcp from <inet_vital> to $int_qld_tftp port { ftp-data ftp 1024:65535 }
pass in log quick on $ext_if proto tcp from <inet_vital> to $int_qld_tftp port 22
pass in log quick on $ext_if proto tcp from <ape_sites> to $int_bne_iis port { ftp 49152:65535 }
pass in log quick on $ext_if proto tcp from <ape_sites> to $int_bne_dax09 port { ftp 49152:65535 }
pass in     quick on $ext_if proto tcp from <ape_sites> to $int_aus_intranet port www 

# Allow access to APEagers Sties via RDP
pass out log quick on $ext_if proto tcp from any to <ape_sites> port 3389

pass in log quick on $ext_if proto tcp from any to $int_bma_cctv port 6100 keep state
pass in log quick on $ext_if proto tcp from any to $int_bma_cctv port 80 keep state

pass in log quick on $ext_if proto tcp from $inet_butterfly to $int_aus_intranet

pass in log quick on $ext_if proto tcp from any to $int_bne_apps port 3389 keep state

pass in log quick on $ext_if proto tcp from <inet_titan> to $int_qld_titan port 3389 keep state

pass in log quick on $ext_if proto tcp from <inet_tune> to <int_tune> port 3389 keep state
pass in log quick on $ext_if proto tcp from <inet_tune> to 10.1.4.11 port { ftp-data ftp 49152:65535 }

# Allow access to Citrix and OWA
pass in log quick on $ext_if proto tcp from any to $int_citrixgabba port { $citrix_ports }
pass in log quick on $ext_if proto tcp from any to $int_qld_cit1 port { $citrix_ports }

##### OTHER INTERFACE RULES
# Allow all traffic out. 
pass out all

# Pass in internal traffic
pass on $int_if no state
pass out on $int_if from any to any keep state

# Antispoof loopback
antispoof quick for { lo $int_if }

# Allow DNS transfers and queries
pass in quick on { $int_if } proto { tcp, udp } from any port domain to any keep state
pass in quick on { $int_if } proto { tcp, udp } from any to any port domain keep state
